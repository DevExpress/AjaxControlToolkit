Type.registerNamespace("Sys.Extended.UI.HtmlEditor.Popups"),Sys.Extended.UI.HtmlEditor.Popups.Popup=function(e){Sys.Extended.UI.HtmlEditor.Popups.Popup.initializeBase(this,[e]),this._iframe=null,this._top=0,this._left=0,this._doc=null,this._initialContent="",this._cssPath="",this._autoDimensions=!0,this._registeredFields=[],this._registeredHandlers=[],this._app_onload$delegate=Function.createDelegate(this,this._app_onload),this.isOpened=!1,this.isLoaded=!1,this.isLoading=!1},Sys.Extended.UI.HtmlEditor.Popups.Popup.prototype={getDocument:function(){return this._doc},getPopupMediator:function(){return this._iframe.contentWindow&&this._iframe.contentWindow.popupMediator?this._iframe.contentWindow.popupMediator:null},get_registeredFields:function(){return this._registeredFields},set_registeredFields:function(value){this._registeredFields=eval(value)},get_registeredHandlers:function(){return this._registeredHandlers},set_registeredHandlers:function(value){this._registeredHandlers=eval(value)},get_initialContent:function(){return this._initialContent},set_initialContent:function(e){this._initialContent=e},get_cssPath:function(){return this._cssPath},set_cssPath:function(e){this._cssPath=e},get_autoDimensions:function(){return this._autoDimensions},set_autoDimensions:function(e){this._autoDimensions=e},get_iframe:function(){return this._iframe},set_iframe:function(e){this._iframe=e},checkCorrectLoaded:function(e){var t=this;return!t.isLoaded||"0px"!=t._iframe.style.height&&"0px"!=t._iframe.style.width||(this.isLoaded=!1),!!this.isLoaded||(this.isLoading||this.reload(),"undefined"!=typeof e&&setTimeout(e,10),!1)},_baseOpen:function(e,t,i){var s=this;if(this.checkCorrectLoaded(function(){s._baseOpen(e,t,i)})){var n=this.get_element();"undefined"!=typeof i&&(this._left=parseInt(i)),"undefined"!=typeof t&&(this._top=parseInt(t)),n.style.top=this._top+"px",n.style.left=this._left+"px",setTimeout(function(){"function"==typeof e&&s._onDocumentLoaded(e),s.isOpened=!0},0)}},open:function(e,t,i){this._baseOpen(e,t,i)},close:function(e){var t=this.get_element();this.isOpened=!1,t.style.top="-2000px",t.style.left="-2000px","function"==typeof e&&e()},reload:function(){this.isLoading=!0;var e=this.get_element(),t=e.parentNode;document.body.appendChild(e),t.appendChild(this.get_element()),this._doc=this._iframe.contentWindow.document,this._doc.open();var i=new Sys.StringBuilder;i.append('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html><head>'),this._cssPath.length>0&&i.append('<link rel="stylesheet" href="'+this._cssPath+'" media="all" />'),i.append("<script>var __loaded__ = false;</script></head><body style='margin:0px; padding:0px; border-width:0px;' onload='__loaded__ = true;'>"),this._autoDimensions&&i.append("<table cellspacing='0' cellpadding='0' border='0'><tr><td>"),i.append(this._initialContent),this._autoDimensions&&i.append("</td></tr></table>"),i.append("</body></html>"),this._doc.write(i.toString()),this._doc.close(),this.isLoaded=!1,this._afterReload()},_afterReload:function(){var e=this._iframe.contentWindow,t=this;if(this.isLoaded=e.__loaded__,t._doc.body&&t._doc.body.innerHTML||(this.isLoaded=!1),!this.isLoaded)return void setTimeout(function(){t._afterReload()},10);this.isLoaded=!1,e.popupMediator={},e.popupMediator.registeredFields=this._registeredFields,e.popupMediator.registeredHandlers=this._registeredHandlers,e.popupMediator.get_callMethodByName=function(t){for(var i=e.popupMediator.registeredHandlers,s=0;s<i.length;s++){var n=i[s];if(n.name==t)return n.callMethod}return null},e.popupMediator.set_callMethodByName=function(t,i){for(var s=e.popupMediator.registeredHandlers,n=0;n<s.length;n++){var o=s[n];o.name==t&&(o.callMethod=i)}},e.popupMediator.getField=function(t){for(var i=e.popupMediator.registeredFields,s=0;s<i.length;s++){var n=i[s];if(n.name==t)return e.document.getElementById(n.clientID)}return null},e.Sys=Sys;for(var i=0;i<this._registeredHandlers.length;i++)$find(this._registeredHandlers[i].clientID).activate(e.document.getElementById(this._registeredHandlers[i].clientID));if(Sys.Extended.UI.HtmlEditor.isIE)t._doc.onselectstart=function(){var e=t._iframe.contentWindow.event,i=e.srcElement.tagName.toUpperCase();return"INPUT"==i||"TEXTAREA"==i};else{t._doc.onmousedown=function(e){var t=e.target.tagName.toUpperCase();return"INPUT"==t||"TEXTAREA"==t||"SELECT"==t||!(!Sys.Extended.UI.HtmlEditor.isSafari||"TABLE"!=t&&"TR"!=t&&"TD"!=t&&"DIV"!=t)};for(var s=t._doc.getElementsByTagName("input"),i=0;i<s.length;i++)s[i].setAttribute("autocomplete","off")}this._autoDimensions?(t._iframe.style.height="1000px",t._iframe.style.width="1000px",setTimeout(function(){t._iframe.style.height=t._doc.body.firstChild.offsetHeight+"px",t._iframe.style.width=t._doc.body.firstChild.offsetWidth+"px",t.isLoaded=!0,t.isLoading=!1},0)):(t.isLoaded=!0,t.isLoading=!1)},_onDocumentLoaded:function(e){var t=this;return this.isLoaded?(this.isLoaded=!0,void e(this._iframe.contentWindow)):void setTimeout(function(){t._onDocumentLoaded(e)},10)},initialize:function(){this.__appLoaded__=!1,Sys.Extended.UI.HtmlEditor.Popups.Popup.callBaseMethod(this,"initialize"),Sys.Application.add_load(this._app_onload$delegate)},dispose:function(){Sys.Application.remove_load(this._app_onload$delegate),this.isOpened&&this.close(),Sys.Extended.UI.HtmlEditor.Popups.Popup.callBaseMethod(this,"dispose")},_app_onload:function(e,t){if(!this.__appLoaded__){this.__appLoaded__=!0;var i=this.get_element();Sys.Extended.UI.HtmlEditor.isReallyVisible(i)&&(this._parentNode_=i.parentNode,this.reload())}}},Sys.Extended.UI.HtmlEditor.Popups.Popup.registerClass("Sys.Extended.UI.HtmlEditor.Popups.Popup",Sys.UI.Control);