// (c) 2010 CodePlex Foundation
(function(){var b="ExtendedColorPicker";function a(){var h="hidden",g="hiding",f="shown",e="showing",d="colorSelectionChanged",b=false,c=true,a=null;Type.registerNamespace("Sys.Extended.UI");Sys.Extended.UI.ColorPickerBehavior=function(e){var d=this;Sys.Extended.UI.ColorPickerBehavior.initializeBase(d,[e]);d._textbox=Sys.Extended.UI.TextBoxWrapper.get_Wrapper(e);d._button=a;d._sample=a;d._cssClass="ajax__colorPicker";d._popupPosition=Sys.Extended.UI.PositioningMode.BottomLeft;d._selectedColor=a;d._enabled=c;d._selectedColorChanging=b;d._popupMouseDown=b;d._isOpen=b;d._blur=new Sys.Extended.UI.DeferredOperation(1,d,d._doBlur);d._popupBehavior=a;d._container=a;d._popupDiv=a;d._colorsTable=a;d._colorsBody=a;d._button$delegates={click:Function.createDelegate(d,d._button_onclick),keypress:Function.createDelegate(d,d._button_onkeypress),blur:Function.createDelegate(d,d._button_onblur)};d._element$delegates={change:Function.createDelegate(d,d._element_onchange),keypress:Function.createDelegate(d,d._element_onkeypress),click:Function.createDelegate(d,d._element_onclick),focus:Function.createDelegate(d,d._element_onfocus),blur:Function.createDelegate(d,d._element_onblur)};d._popup$delegates={mousedown:Function.createDelegate(d,d._popup_onmousedown),mouseup:Function.createDelegate(d,d._popup_onmouseup),drag:Function.createDelegate(d,d._popup_onevent),dragstart:Function.createDelegate(d,d._popup_onevent),select:Function.createDelegate(d,d._popup_onevent)};d._cell$delegates={mouseover:Function.createDelegate(d,d._cell_onmouseover),mouseout:Function.createDelegate(d,d._cell_onmouseout),click:Function.createDelegate(d,d._cell_onclick)}};Sys.Extended.UI.ColorPickerBehavior.prototype={initialize:function(){var a=this;Sys.Extended.UI.ColorPickerBehavior.callBaseMethod(a,"initialize");if(!Sys.Extended.UI.ColorPickerBehavior._colorRegex)Sys.Extended.UI.ColorPickerBehavior._colorRegex=new RegExp("^[A-Fa-f0-9]{6}$");var c=a.get_element();$addHandlers(c,a._element$delegates);a._button&&$addHandlers(a._button,a._button$delegates);var b=a.get_selectedColor();b&&a.set_selectedColor(b);a._restoreSample()},dispose:function(){var b=this;b._sample=a;if(b._button){$clearHandlers(b._button);b._button=a}if(b._popupBehavior){b._popupBehavior.dispose();b._popupBehavior=a}if(b._container){b._container.parentNode&&b._container.parentNode.removeChild(b._container);b._container=a}if(b._popupDiv){$clearHandlers(b._popupDiv);b._popupDiv=a}if(b._colorsBody){for(var c=0;c<b._colorsBody.rows.length;c++)for(var f=b._colorsBody.rows[c],d=0;d<f.cells.length;d++)$clearHandlers(f.cells[d].firstChild);b._colorsBody=a}b._colorsTable=a;var e=b.get_element();e&&$clearHandlers(e);Sys.Extended.UI.ColorPickerBehavior.callBaseMethod(b,"dispose")},get_button:function(){return this._button},set_button:function(b){var a=this;if(a._button!==b){a._button&&a.get_isInitialized()&&$common.removeHandlers(a._button,a._button$delegates);a._button=b;a._button&&a.get_isInitialized()&&$addHandlers(a._button,a._button$delegates);a.raisePropertyChanged("button")}},get_sample:function(){return this._sample},set_sample:function(a){if(this._sample!==a){this._sample=a;this.raisePropertyChanged("sample")}},get_selectedColor:function(){var b=this;if(b._selectedColor===a){var c=b._textbox.get_Value();if(b._validate(c))b._selectedColor=c}return b._selectedColor},set_selectedColor:function(d){var a=this;if(a._selectedColor!==d&&a._validate(d)){a._selectedColor=d;a._selectedColorChanging=c;d!==a._textbox.get_Value()&&a._textbox.set_Value(d);a._showSample(d);a._selectedColorChanging=b;a.raisePropertyChanged("selectedColor")}},get_enabled:function(){return this._enabled},set_enabled:function(a){if(this._enabled!==a){this._enabled=a;this.raisePropertyChanged("enabled")}},get_popupPosition:function(){return this._popupPosition},set_popupPosition:function(a){if(this._popupPosition!==a){this._popupPosition=a;this.raisePropertyChanged("popupPosition")}},add_colorSelectionChanged:function(a){this.get_events().addHandler(d,a)},remove_colorSelectionChanged:function(a){this.get_events().removeHandler(d,a)},raiseColorSelectionChanged:function(){var a=this.get_events().getHandler(d);a&&a(this,Sys.EventArgs.Empty)},add_showing:function(a){this.get_events().addHandler(e,a)},remove_showing:function(a){this.get_events().removeHandler(e,a)},raiseShowing:function(b){var a=this.get_events().getHandler(e);a&&a(this,b)},add_shown:function(a){this.get_events().addHandler(f,a)},remove_shown:function(a){this.get_events().removeHandler(f,a)},raiseShown:function(){var a=this.get_events().getHandler(f);a&&a(this,Sys.EventArgs.Empty)},add_hiding:function(a){this.get_events().addHandler(g,a)},remove_hiding:function(a){this.get_events().removeHandler(g,a)},raiseHiding:function(b){var a=this.get_events().getHandler(g);a&&a(this,b)},add_hidden:function(a){this.get_events().addHandler(h,a)},remove_hidden:function(a){this.get_events().removeHandler(h,a)},raiseHidden:function(){var a=this.get_events().getHandler(h);a&&a(this,Sys.EventArgs.Empty)},show:function(){var a=this;a._ensureColorPicker();if(!a._isOpen){var b=new Sys.CancelEventArgs;a.raiseShowing(b);if(b.get_cancel())return;a._isOpen=c;a._popupBehavior.show();a.raiseShown()}},hide:function(){var a=this;if(a._isOpen){var c=new Sys.CancelEventArgs;a.raiseHiding(c);if(c.get_cancel())return;a._container&&a._popupBehavior.hide();a._isOpen=b;a.raiseHidden();a._popupMouseDown=b}},_focus:function(){if(this._button)this._button.focus();else this.get_element().focus()},_doBlur:function(d){var a=this;if(!d&&Sys.Browser.agent===Sys.Browser.Opera)a._blur.post(c);else{!a._popupMouseDown&&a.hide();a._popupMouseDown=b}},_buildColorPicker:function(){var a=this,d=a.get_element(),c=a.get_id();a._container=$common.createElementFromTemplate({nodeName:"div",properties:{id:c+"_container"},cssClasses:[a._cssClass]},d.parentNode);a._popupDiv=$common.createElementFromTemplate({nodeName:"div",events:a._popup$delegates,properties:{id:c+"_popupDiv"},cssClasses:["ajax__colorPicker_container"],visible:b},a._container)},_buildColors:function(){var a=this,f=a.get_id();a._colorsTable=$common.createElementFromTemplate({nodeName:"table",properties:{id:f+"_colorsTable",cellPadding:0,cellSpacing:1,border:0,style:{margin:"auto"}}},a._popupDiv);a._colorsBody=$common.createElementFromTemplate({nodeName:"tbody",properties:{id:f+"_colorsBody"}},a._colorsTable);for(var c=["00","99","33","66","FF","CC"],b,e,h=c.length,i=0;i<h;i++)for(var j=$common.createElementFromTemplate({nodeName:"tr"},a._colorsBody),d=0;d<h;d++){if(d===3)j=$common.createElementFromTemplate({nodeName:"tr"},a._colorsBody);for(var g=0;g<h;g++){b=c[i]+c[d]+c[g];e="#"+b;var k=$common.createElementFromTemplate({nodeName:"td"},j),l=$common.createElementFromTemplate({nodeName:"div",properties:{id:f+"_color_"+b,color:b,title:e,style:{backgroundColor:e},innerHTML:"&nbsp;"},events:a._cell$delegates},k)}}},_ensureColorPicker:function(){var a=this;if(!a._container){var b=a.get_element();a._buildColorPicker();a._buildColors();a._popupBehavior=new $create(Sys.Extended.UI.PopupBehavior,{parentElement:b},{},{},a._popupDiv);a._popupBehavior.set_positioningMode(a._popupPosition)}},_showSample:function(b){if(this._sample){var a="";if(b)a="#"+b;this._sample.style.backgroundColor=a}},_restoreSample:function(){this._showSample(this._selectedColor)},_validate:function(a){return a&&Sys.Extended.UI.ColorPickerBehavior._colorRegex.test(a)},_element_onfocus:function(){var a=this;if(!a._enabled)return;if(!a._button){a.show();a._popupMouseDown=b}},_element_onblur:function(){if(!this._enabled)return;!this._button&&this._doBlur()},_element_onchange:function(){var a=this;if(!a._selectedColorChanging){var b=a._textbox.get_Value();if(a._validate(b)||b===""){a._selectedColor=b;a._restoreSample()}}},_element_onkeypress:function(a){if(!this._enabled)return;if(!this._button&&a.charCode===Sys.UI.Key.esc){a.stopPropagation();a.preventDefault();this.hide()}},_element_onclick:function(){var a=this;if(!a._enabled)return;if(!a._button){a.show();a._popupMouseDown=b}},_popup_onevent:function(a){a.stopPropagation();a.preventDefault()},_popup_onmousedown:function(){this._popupMouseDown=c},_popup_onmouseup:function(){var a=this;Sys.Browser.agent===Sys.Browser.Opera&&a._blur.get_isPending()&&a._blur.cancel();a._popupMouseDown=b;a._focus()},_cell_onmouseover:function(a){a.stopPropagation();var b=a.target;this._showSample(b.color)},_cell_onmouseout:function(a){a.stopPropagation();this._restoreSample()},_cell_onclick:function(b){var a=this;b.stopPropagation();b.preventDefault();if(!a._enabled)return;var d=b.target;a.set_selectedColor(d.color);a._blur.post(c);a.raiseColorSelectionChanged()},_button_onclick:function(c){var a=this;c.preventDefault();c.stopPropagation();if(!a._enabled)return;if(!a._isOpen)a.show();else a.hide();a._focus();a._popupMouseDown=b},_button_onblur:function(){var a=this;if(!a._enabled)return;!a._popupMouseDown&&a.hide();a._popupMouseDown=b},_button_onkeypress:function(a){if(!this._enabled)return;if(a.charCode===Sys.UI.Key.esc){a.stopPropagation();a.preventDefault();this.hide()}this._popupMouseDown=b}};Sys.Extended.UI.ColorPickerBehavior.registerClass("Sys.Extended.UI.ColorPickerBehavior",Sys.Extended.UI.BehaviorBase);Sys.registerComponent(Sys.Extended.UI.ColorPickerBehavior,{name:"colorPicker"})}if(window.Sys&&Sys.loader)Sys.loader.registerScript(b,["ExtendedBase","ExtendedCommon","ExtendedThreading","ExtendedPopup"],a);else a()})();