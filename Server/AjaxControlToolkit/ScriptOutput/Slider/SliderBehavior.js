// (c) 2010 CodePlex Foundation
(function(){var b="ExtendedSlider";function a(){var m="valueChanged",l="slideStart",k="slideEnd",o="selectstart",n="keypress",j="change",i="INPUT",h="sliderInitialized",e="1px",d="0px",g="absolute",f="hidden",b=true,c=false,a=null;Type.registerNamespace("Sys.Extended.UI");Sys.Extended.UI._SliderDragDropManagerInternal=function(){Sys.Extended.UI._SliderDragDropManagerInternal.initializeBase(this);this._instance=a};Sys.Extended.UI._SliderDragDropManagerInternal.prototype={_getInstance:function(){var a=this;a._instance=new Sys.Extended.UI.GenericDragDropManager;a._instance.initialize();a._instance.add_dragStart(Function.createDelegate(a,a._raiseDragStart));a._instance.add_dragStop(Function.createDelegate(a,a._raiseDragStop));return a._instance}};Sys.Extended.UI._SliderDragDropManagerInternal.registerClass("Sys.Extended.UI._SliderDragDropManagerInternal",Sys.Extended.UI._DragDropManager);Sys.Extended.UI.SliderDragDropManagerInternal=new Sys.Extended.UI._SliderDragDropManagerInternal;Sys.Extended.UI.SliderOrientation=function(){};Sys.Extended.UI.SliderOrientation.prototype={Horizontal:0,Vertical:1};Sys.Extended.UI.SliderOrientation.registerEnum("Sys.Extended.UI.SliderOrientation",c);Sys.Extended.UI.SliderBehavior=function(e){var d=this;Sys.Extended.UI.SliderBehavior.initializeBase(d,[e]);d._minimum=0;d._maximum=100;d._value=a;d._steps=0;d._decimals=0;d._orientation=Sys.Extended.UI.SliderOrientation.Horizontal;d._railElement=a;d._railCssClass=a;d._isHorizontal=b;d._isUpdatingInternal=c;d._isInitializedInternal=c;d._enableHandleAnimation=c;d._handle=a;d._handleImage=a;d._handleAnimation=a;d._handleAnimationDuration=.1;d._handleImageUrl=a;d._handleCssClass=a;d._dragHandle=a;d._mouseupHandler=a;d._selectstartHandler=a;d._boundControlChangeHandler=a;d._boundControlKeyPressHandler=a;d._boundControlID=a;d._boundControl=a;d._length=a;d._raiseChangeOnlyOnMouseUp=b;d._animationPending=c;d._selectstartPending=c;d._tooltipText="";d._enableKeyboard=b;d._keyDownHandler=a};Sys.Extended.UI.SliderBehavior.prototype={initialize:function(){Sys.Extended.UI.SliderBehavior.callBaseMethod(this,"initialize");this._initializeLayout()},dispose:function(){var a=this;a._disposeHandlers();a._disposeBoundControl();a._enableHandleAnimation&&a._handleAnimation&&a._handleAnimation.dispose();Sys.Extended.UI.SliderBehavior.callBaseMethod(a,"dispose")},_initializeLayout:function(){var a=this;a._railElement=document.createElement("DIV");a._railElement.id=a.get_id()+"_railElement";a._railElement.tabIndex=-1;a._railElement.innerHTML="<div></div>";a._handle=a._railElement.childNodes[0];a._handle.style.overflow=f;a._handle.style.position=g;if(Sys.Browser.agent==Sys.Browser.Opera){a._handle.style.left=d;a._handle.style.top=d}var e=a.get_element(),j=$common.getBounds(e);e.parentNode.insertBefore(a._railElement,e);a._isHorizontal=a._orientation==Sys.Extended.UI.SliderOrientation.Horizontal;var i=a._isHorizontal?"ajax__slider_h_rail":"ajax__slider_v_rail",h=a._isHorizontal?"ajax__slider_h_handle":"ajax__slider_v_handle",c=a._isHorizontal?"slider_h_handle.gif":"slider_v_handle.gif";if(Sys.loader){var b=Sys.loader.basePath;if(b){if(b.charAt(b.length-1)!=="/")b+="/";c=b+"extended/slider/images/"+c}}a._railElement.className=a._railCssClass?a._railCssClass:i;a._handle.className=a._handleCssClass?a._handleCssClass:h;if(!a._handleImageUrl)a._handleImageUrl=c;if(a._isHorizontal){if(a._length)a._railElement.style.width=a._length}else if(a._length)a._railElement.style.height=a._length;a._loadHandleImage();a._enforceTextBoxElementPositioning();a._hideTextBoxElement();a._initializeSlider()},_enforceTextBoxElementPositioning:function(){var b=this,a={position:b.get_element().style.position,top:b.get_element().style.top,right:b.get_element().style.right,bottom:b.get_element().style.bottom,left:b.get_element().style.left};if(a.position!="")b._railElement.style.position=a.position;if(a.top!="")b._railElement.style.top=a.top;if(a.right!="")b._railElement.style.right=a.right;if(a.bottom!="")b._railElement.style.bottom=a.bottom;if(a.left!="")b._railElement.style.left=a.left},_hideTextBoxElement:function(){var a=this.get_element();a.readOnly=b;var c=d;if(Sys.Browser.agent==Sys.Browser.Safari)c=e;a.style.width=c;a.style.height=c;a.style.border=d;a.style.padding=d;a.style.margin=d;a.style.fontSize=e;a.style.lineHeight=e;a.style.outline="0";a.style.position=g},_loadHandleImage:function(){var a=this;a._handleImage=document.createElement("IMG");a._handleImage.id=a.get_id()+"_handleImage";a._handle.appendChild(a._handleImage);a._handleImage.src=a._handleImageUrl},_initializeSlider:function(){var a=this;a._initializeBoundControl();var c;try{c=parseFloat(a.get_element().value)}catch(d){c=Number.NaN}a.set_Value(c);a._setHandleOffset(a._value);a._initializeDragHandle();Sys.Extended.UI.SliderDragDropManagerInternal.registerDropTarget(a);a._initializeHandlers();a._initializeHandleAnimation();a._isInitializedInternal=b;a._raiseEvent(h)},_initializeBoundControl:function(){var a=this;if(a._boundControl){var b=a._boundControl.nodeName==i;if(b){a._boundControlChangeHandler=Function.createDelegate(a,a._onBoundControlChange);a._boundControlKeyPressHandler=Function.createDelegate(a,a._onBoundControlKeyPress);$addHandler(a._boundControl,j,a._boundControlChangeHandler);$addHandler(a._boundControl,n,a._boundControlKeyPressHandler)}}},_disposeBoundControl:function(){var a=this;if(a._boundControl){var b=a._boundControl.nodeName==i;if(b){$removeHandler(a._boundControl,j,a._boundControlChangeHandler);$removeHandler(a._boundControl,n,a._boundControlKeyPressHandler)}}},_onBoundControlChange:function(){this._animationPending=b;this._setValueFromBoundControl()},_onBoundControlKeyPress:function(a){if(a.charCode==13){this._animationPending=b;this._setValueFromBoundControl();a.preventDefault()}},_setValueFromBoundControl:function(){var a=this;a._isUpdatingInternal=b;a._boundControlID&&a._calcValue($get(a._boundControlID).value);a._isUpdatingInternal=c},_initializeHandleAnimation:function(){var a=this;if(a._steps>0){a._enableHandleAnimation=c;return}if(a._enableHandleAnimation)a._handleAnimation=new Sys.Extended.UI.Animation.LengthAnimation(a._handle,a._handleAnimationDuration,100,"style")},_ensureBinding:function(){var a=this;if(a._boundControl){var b=a._value;if(b>=a._minimum||b<=a._maximum){var c=a._boundControl.nodeName==i;if(c)a._boundControl.value=b;else if(a._boundControl)a._boundControl.innerHTML=b}}},_getBoundsInternal:function(d){var a=$common.getBounds(d);function e(){return a.width>0&&a.height>0}if(!e()){a.width=parseInt($common.getCurrentStyle(d,"width"));a.height=parseInt($common.getCurrentStyle(d,"height"));if(!e()){var c=d.cloneNode(b);c.visibility=f;document.body.appendChild(c);a.width=parseInt($common.getCurrentStyle(c,"width"));a.height=parseInt($common.getCurrentStyle(c,"height"));document.body.removeChild(c);if(!e())throw Error.argument("element size",Sys.Extended.UI.Resources.Slider_NoSizeProvided);}}if(this._orientation==Sys.Extended.UI.SliderOrientation.Vertical)a={x:a.y,y:a.x,height:a.width,width:a.height,right:a.right,bottom:a.bottom,location:{x:a.y,y:a.x},size:{width:a.height,height:a.width}};return a},_getRailBounds:function(){return this._getBoundsInternal(this._railElement)},_getHandleBounds:function(){return this._getBoundsInternal(this._handle)},_initializeDragHandle:function(){var a=this._dragHandle=document.createElement("DIV");a.style.position=g;a.style.width=e;a.style.height=e;a.style.overflow=f;a.style.zIndex="999";a.style.background="none";document.body.appendChild(this._dragHandle)},_resetDragHandle:function(){var a=$common.getBounds(this._handle);$common.setLocation(this._dragHandle,{x:a.x,y:a.y})},_initializeHandlers:function(){var a=this;a._selectstartHandler=Function.createDelegate(a,a._onSelectStart);a._mouseupHandler=Function.createDelegate(a,a._onMouseUp);a._keyDownHandler=Function.createDelegate(a,a._onKeyDown);$addHandler(document,"mouseup",a._mouseupHandler);$addHandler(a.get_element(),"keydown",a._keyDownHandler);$addHandlers(a._handle,{mousedown:a._onMouseDown,dragstart:a._IEDragDropHandler,drag:a._IEDragDropHandler,dragend:a._IEDragDropHandler},a);$addHandlers(a._railElement,{click:a._onRailClick},a)},_disposeHandlers:function(){var b=this;$clearHandlers(b._handle);$clearHandlers(b._railElement);$removeHandler(b.get_element(),"keydown",b._keyDownHandler);$removeHandler(document,"mouseup",b._mouseupHandler);b._keyDownHandler=a;b._mouseupHandler=a;b._selectstartHandler=a},startDragDrop:function(b){this._resetDragHandle();Sys.Extended.UI.SliderDragDropManagerInternal.startDragDrop(this,b,a)},_onMouseDown:function(c){var a=this;window._event=c;c.preventDefault();if(!Sys.Extended.UI.SliderBehavior.DropPending){Sys.Extended.UI.SliderBehavior.DropPending=a;$addHandler(document,o,a._selectstartHandler);a._selectstartPending=b;a.startDragDrop(a._dragHandle)}},_onMouseUp:function(b){var c=b.target;if(Sys.Extended.UI.SliderBehavior.DropPending==this){Sys.Extended.UI.SliderBehavior.DropPending=a;this._selectstartPending&&$removeHandler(document,o,this._selectstartHandler)}},_onKeyDown:function(d){if(this._enableKeyboard){var a=new Sys.UI.DomEvent(d);switch(a.keyCode||a.rawEvent.keyCode){case Sys.UI.Key.up:case Sys.UI.Key.left:this._handleSlide(b);a.preventDefault();return;case Sys.UI.Key.down:case Sys.UI.Key.right:this._handleSlide(c);a.preventDefault();return c;default:return c}}},_handleSlide:function(f){var a=this;a._animationPending=b;a._isUpdatingInternal=b;var e=a.get_Value(),d;if(a._steps>0){var g=a._maximum-a._minimum,h=(g/(a._steps-1)).toFixed(a._decimals);d=h}else d=a._decimals==0?1:1/Math.pow(10,a._decimals);if(f)d=0-d;a._calcValue(parseFloat(e)+parseFloat(d));a._isUpdatingInternal=c;a._fireTextBoxChangeEvent()},_onRailClick:function(a){if(a.target==this._railElement){this._animationPending=b;this._onRailClicked(a)}},_IEDragDropHandler:function(a){a.preventDefault()},_onSelectStart:function(a){a.preventDefault()},_calcValue:function(e,k){var d=this,f;if(e!=a){if(!Number.isInstanceOfType(e))try{e=parseFloat(e)}catch(o){e=Number.NaN}if(isNaN(e))e=d._minimum;f=e<d._minimum?d._minimum:e>d._maximum?d._maximum:e}else{var i=d._minimum,l=d._maximum,g=d._getHandleBounds(),h=d._getRailBounds(),j=k?k-g.width/2:g.x-h.x,n=h.width-g.width,m=j/n;f=j==0?i:j==h.width-g.width?l:i+m*(l-i)}if(d._steps>0)f=d._getNearestStepValue(f);f=f<d._minimum?d._minimum:f>d._maximum?d._maximum:f;d._isUpdatingInternal=b;d.set_Value(f);d._isUpdatingInternal=c;return f},_setHandleOffset:function(g,i){var a=this,e=a._minimum,h=a._maximum,b=a._getHandleBounds(),d=a._getRailBounds(),l=h-e,k=(g-e)/l,j=Math.round(k*(d.width-b.width)),f=g==e?0:g==h?d.width-b.width:j;if(i){a._handleAnimation.set_startValue(b.x-d.x);a._handleAnimation.set_endValue(f);a._handleAnimation.set_propertyKey(a._isHorizontal?"left":"top");a._handleAnimation.play();a._animationPending=c}else if(a._isHorizontal)a._handle.style.left=f+"px";else a._handle.style.top=f+"px"},_getNearestStepValue:function(b){var a=this;if(a._steps==0)return b;var c=a._maximum-a._minimum;if(c==0)return b;var d=c/(a._steps-1);return Math.round(b/d)*d},_onHandleReleased:function(){this._raiseChangeOnlyOnMouseUp&&this._fireTextBoxChangeEvent();this._raiseEvent(k)},_onRailClicked:function(g){var c=this,h=c._getHandleBounds(),i=c._getRailBounds(),d=c._isHorizontal?g.offsetX:g.offsetY,e=h.width/2,f=i.width-e;d=d<e?e:d>f?f:d;c._calcValue(a,d,b);c.get_element().focus();c._fireTextBoxChangeEvent()},_fireTextBoxChangeEvent:function(){if(document.createEvent){var a=document.createEvent("HTMLEvents");a.initEvent(j,b,c);this.get_element().dispatchEvent(a)}else document.createEventObject&&this.get_element().fireEvent("onchange")},get_dragDataType:function(){return"HTML"},getDragData:function(){return this._handle},get_dragMode:function(){return Sys.Extended.UI.DragMode.Move},onDragStart:function(){this.get_element().focus();this._resetDragHandle();this._raiseEvent(l)},onDrag:function(){var b=this,e=b._getBoundsInternal(b._dragHandle),g=b._getHandleBounds(),f=b._getRailBounds(),d;if(b._isHorizontal)d={x:e.x-f.x,y:0};else d={y:e.x-f.x,x:0};$common.setLocation(b._handle,d);b._calcValue(a,a);b._steps>1&&b._setHandleOffset(b.get_Value(),c)},onDragEnd:function(){this._onHandleReleased()},get_dropTargetElement:function(){return document.body},canDrop:function(b,a){return a=="HTML"},drop:Function.emptyMethod,onDragEnterTarget:Function.emptyMethod,onDragLeaveTarget:Function.emptyMethod,onDragInTarget:Function.emptyMethod,add_sliderInitialized:function(a){this.get_events().addHandler(h,a)},remove_sliderInitialized:function(a){this.get_events().removeHandler(h,a)},add_valueChanged:function(a){this.get_events().addHandler(m,a)},remove_valueChanged:function(a){this.get_events().removeHandler(m,a)},add_slideStart:function(a){this.get_events().addHandler(l,a)},remove_slideStart:function(a){this.get_events().removeHandler(l,a)},add_slideEnd:function(a){this.get_events().addHandler(k,a)},remove_slideEnd:function(a){this.get_events().removeHandler(k,a)},_raiseEvent:function(c,a){var b=this.get_events().getHandler(c);if(b){if(!a)a=Sys.EventArgs.Empty;b(this,a)}},get_Value:function(){return this._value},set_Value:function(c){var a=this,d=a._value,b=c;if(!a._isUpdatingInternal)b=a._calcValue(c);a.get_element().value=a._value=b.toFixed(a._decimals);a._ensureBinding();if(!Number.isInstanceOfType(a._value))try{a._value=parseFloat(a._value)}catch(e){a._value=Number.NaN}if(a._tooltipText)a._handle.alt=a._handle.title=String.format(a._tooltipText,a._value);if(a._isInitializedInternal){a._setHandleOffset(b,a._enableHandleAnimation&&a._animationPending);if(a._isUpdatingInternal)!a._raiseChangeOnlyOnMouseUp&&a._fireTextBoxChangeEvent();a._value!=d&&a._raiseEvent(m)}},get_RailCssClass:function(){return this._railCssClass},set_RailCssClass:function(a){this._railCssClass=a},get_HandleImageUrl:function(){return this._handleImageUrl},set_HandleImageUrl:function(a){this._handleImageUrl=a},get_HandleCssClass:function(){return this._handleCssClass},set_HandleCssClass:function(a){this._handleCssClass=a},get_Minimum:function(){return this._minimum},set_Minimum:function(a){this._minimum=a},get_Maximum:function(){return this._maximum},set_Maximum:function(a){this._maximum=a},get_Orientation:function(){return this._orientation},set_Orientation:function(a){this._orientation=a},get_Steps:function(){return this._steps},set_Steps:function(b){var a=this;a._steps=Math.abs(b);a._steps=a._steps==1?2:a._steps},get_Decimals:function(){return this._decimals},set_Decimals:function(a){this._decimals=Math.abs(a)},get_EnableHandleAnimation:function(){return this._enableHandleAnimation},set_EnableHandleAnimation:function(a){this._enableHandleAnimation=a},get_HandleAnimationDuration:function(){return this._handleAnimationDuration},set_HandleAnimationDuration:function(a){this._handleAnimationDuration=a},get_BoundControlID:function(){return this._boundControlID},set_BoundControlID:function(c){var b=this;b._boundControlID=c;if(b._boundControlID)b._boundControl=$get(b._boundControlID);else b._boundControl=a},get_Length:function(){return this._length},set_Length:function(a){this._length=a+"px"},get_SliderInitialized:function(){return this._isInitializedInternal},get_RaiseChangeOnlyOnMouseUp:function(){return this._raiseChangeOnlyOnMouseUp},set_RaiseChangeOnlyOnMouseUp:function(a){this._raiseChangeOnlyOnMouseUp=a},get_TooltipText:function(){return this._tooltipText},set_TooltipText:function(a){this._tooltipText=a},get_enableKeyboard:function(){return this._enableKeyboard},set_enableKeyboard:function(a){if(a!==this._enableKeyboard){this._enableKeyboard=a;this.raisePropertyChanged("enableKeyboard")}},getClientState:function(){var b=Sys.Extended.UI.SliderBehavior.callBaseMethod(this,"get_ClientState");if(b=="")b=a;return b},setClientState:function(a){return Sys.Extended.UI.SliderBehavior.callBaseMethod(this,"set_ClientState",[a])}};Sys.Extended.UI.SliderBehavior.DropPending=a;Sys.Extended.UI.SliderBehavior.registerClass("Sys.Extended.UI.SliderBehavior",Sys.Extended.UI.BehaviorBase,Sys.Extended.UI.IDragSource,Sys.Extended.UI.IDropTarget);Sys.registerComponent(Sys.Extended.UI.SliderBehavior,{name:"slider"})}if(window.Sys&&Sys.loader)Sys.loader.registerScript(b,["ExtendedBase","ExtendedDragDrop","ExtendedAnimations"],a);else a()})();