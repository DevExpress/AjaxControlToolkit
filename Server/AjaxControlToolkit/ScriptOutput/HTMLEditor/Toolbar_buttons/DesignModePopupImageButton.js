Type.registerNamespace("Sys.Extended.UI.HTMLEditor.ToolbarButton");Sys.Extended.UI.HTMLEditor.ToolbarButton.DesignModePopupImageButton=function(b){var a=this;Sys.Extended.UI.HTMLEditor.ToolbarButton.DesignModePopupImageButton.initializeBase(a,[b]);a._relatedPopup=null;a._autoClose=true;a._forclose_onmousedown$delegate=null};Sys.Extended.UI.HTMLEditor.ToolbarButton.DesignModePopupImageButton.prototype={set_activeEditPanel:function(b){var a=this;a._editPanel!=b&&a._editPanel!=null&&a.closePopup();Sys.Extended.UI.HTMLEditor.ToolbarButton.DesignModePopupImageButton.callBaseMethod(a,"set_activeEditPanel",[b])},get_autoClose:function(){return this._autoClose},set_autoClose:function(a){this._autoClose=a},get_relatedPopup:function(){return this._relatedPopup},set_relatedPopup:function(a){this._relatedPopup=a},openPopup:function(h,j,i){var c=null,a=this;if(a._autoClose&&a._forclose_onmousedown$delegate!=c)return;if(a._relatedPopup!=c){a._bookmark=c;if(Sys.Extended.UI.HTMLEditor.isIE){var e=a._designPanel._getSelection();a._selType=e.type.toLowerCase();var d=a._designPanel._createRange(e);if(a._selType=="text"||a._selType=="none")try{a._bookmark=d.duplicate()}catch(k){}else if(a._selType=="control"){a._bookmark=d.item(0);d.remove(0);e.empty()}}if(typeof a._relatedPopup.set_relatedElement=="function"){a._relatedPopup.set_relatedElement(a.get_element());a._forclose_onmousedown$delegate=Function.createDelegate(a,a._forclose_onmousedown);if(a._autoClose){var f=a._designPanel.get_element().contentWindow,g=f.document.body,b=a;setTimeout(function(){var d="keydown",a="mousedown";if(b._forclose_onmousedown$delegate!=c){Sys.Extended.UI.HTMLEditor._addEvent(g,a,b._forclose_onmousedown$delegate);Sys.Extended.UI.HTMLEditor._addEvent(g,d,b._forclose_onmousedown$delegate);Sys.Extended.UI.HTMLEditor._addEvent(document.body,d,b._forclose_onmousedown$delegate);Sys.Extended.UI.HTMLEditor._addEvent(window,d,b._forclose_onmousedown$delegate);Sys.Extended.UI.HTMLEditor._addEvent(f,a,b._forclose_onmousedown$delegate);Sys.Extended.UI.HTMLEditor._addEvent(document.body,a,b._forclose_onmousedown$delegate);document.documentElement&&Sys.Extended.UI.HTMLEditor._addEvent(document.documentElement,a,b._forclose_onmousedown$delegate)}},0)}a._relatedPopup.open(h)}else a._relatedPopup.open(h,j,i)}},_forclose_onmousedown:function(e){var d="keydown",c="mousedown",a=this;if(a._forclose_onmousedown$delegate==null)return true;if(a._relatedPopup.isOpened)a._relatedPopup.close();else return true;if(a._editPanel==Sys.Extended.UI.HTMLEditor.LastFocusedEditPanel)try{if(a._bookmark){if(Sys.Extended.UI.HTMLEditor.isIE){var b;if(a._selType=="control"){b=a._designPanel._doc.body.createControlRange();b.add(a._bookmark)}else b=a._bookmark;b.select()}a._bookmark=null}if(!Sys.Extended.UI.HTMLEditor.isIE){var f=a._designPanel._getSelection(),b=a._designPanel._createRange(f);a._designPanel._removeAllRanges(f);a._designPanel._selectRange(f,b);a._designPanel.focusEditor()}}catch(j){}var i=a;setTimeout(function(){if(i._editPanel==Sys.Extended.UI.HTMLEditor.LastFocusedEditPanel)try{i._editPanel.updateToolbar()}catch(a){}},0);if(a._autoClose)try{var g=a._designPanel.get_element().contentWindow,h=g.document.body;document.documentElement&&Sys.Extended.UI.HTMLEditor._removeEvent(document.documentElement,c,a._forclose_onmousedown$delegate);Sys.Extended.UI.HTMLEditor._removeEvent(h,d,a._forclose_onmousedown$delegate);Sys.Extended.UI.HTMLEditor._removeEvent(document.body,d,a._forclose_onmousedown$delegate);Sys.Extended.UI.HTMLEditor._removeEvent(window,d,a._forclose_onmousedown$delegate);Sys.Extended.UI.HTMLEditor._removeEvent(h,c,a._forclose_onmousedown$delegate);Sys.Extended.UI.HTMLEditor._removeEvent(g,c,a._forclose_onmousedown$delegate);Sys.Extended.UI.HTMLEditor._removeEvent(document.body,c,a._forclose_onmousedown$delegate)}catch(j){}a._forclose_onmousedown$delegate=null;if(e&&e.type)if(e.type==d){Sys.Extended.UI.HTMLEditor._stopEvent(e);return false}return true},closePopup:function(){this._forclose_onmousedown$delegate!=null&&this._forclose_onmousedown$delegate(null)},dispose:function(){this._forclose_onmousedown$delegate!=null&&this._forclose_onmousedown$delegate(null);Sys.Extended.UI.HTMLEditor.ToolbarButton.DesignModePopupImageButton.callBaseMethod(this,"dispose")}};Sys.Extended.UI.HTMLEditor.ToolbarButton.DesignModePopupImageButton.registerClass("Sys.Extended.UI.HTMLEditor.ToolbarButton.DesignModePopupImageButton",Sys.Extended.UI.HTMLEditor.ToolbarButton.MethodButton);